openapi: 3.0.3
info:
  title: Academy Backend API
  version: 1.0.0
  description: Versioned API for mobile apps (Android/iOS) and web dashboards.
servers:
  - url: http://localhost:5000
    description: Local
paths:
  /api/v1/health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  message: { type: string }
                  data:
                    type: object
                    properties:
                      status: { type: string }
                      db: { type: string }

  /api/v1/auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
                role: { type: string, enum: [user, partner, admin] }
      responses:
        '201': { description: Created }

  /api/v1/auth/login:
    post:
      summary: Login with email/password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/auth/refresh:
    post:
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/auth/send-otp:
    post:
      summary: Send OTP to email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/auth/verify-otp:
    post:
      summary: Verify OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string }
                code: { type: string }
                token: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/profile:
    get:
      summary: Get own profile
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/users/profile/update:
    patch:
      summary: Update profile
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string, example: "New Name" }
                avatar: { type: string, example: "https://cdn.example.com/u/avatar.png" }
      responses:
        '200': { description: OK }

  /api/v1/users/{id}/qr:
    get:
      summary: Get user profile QR (PNG)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: PNG
          content:
            image/png: {}

  /api/v1/users/{id}/card:
    get:
      summary: Get user business card (profile summary)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/{id}/follow:
    post:
      summary: Follow user
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/{id}/unfollow:
    post:
      summary: Unfollow user
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/{id}/followers:
    get:
      summary: List followers
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/{id}/following:
    get:
      summary: List following
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/users/rewards:
    patch:
      summary: Update rewards balance
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/users/referrals:
    post:
      summary: Set referral
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/users/progress:
    post:
      summary: Update progress (mobile)
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/courses:
    get:
      summary: List courses
      responses:
        '200': { description: OK }
    post:
      summary: Create course
      security: [ { bearerAuth: [] } ]
      responses:
        '201': { description: Created }

  /api/v1/courses/{id}:
    get:
      summary: Get course by ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }
    put:
      summary: Update course
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }
    delete:
      summary: Delete course
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/courses/{id}/lessons:
    post:
      summary: Add lesson
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '201': { description: Created }

  /api/v1/courses/{id}/progress:
    post:
      summary: Update progress for current user
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/events:
    get:
      summary: List events
      responses:
        '200': { description: OK }
    post:
      summary: Create event
      security: [ { bearerAuth: [] } ]
      responses:
        '201': { description: Created }

  /api/v1/events/{id}/book:
    post:
      summary: Book event
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/community/posts:
    get:
      summary: List posts
      responses:
        '200': { description: OK }
    post:
      summary: Create post (multipart)
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                content: { type: string }
                image:
                  type: string
                  format: binary
      responses:
        '201': { description: Created }

  /api/v1/community/posts/{id}/like:
    post:
      summary: Toggle like
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/community/posts/{id}/comments:
    post:
      summary: Add comment
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '201': { description: Created }

  /api/v1/rewards/earn:
    post:
      summary: Earn rewards
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/rewards/redeem:
    post:
      summary: Redeem rewards
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

  /api/v1/rewards/leaderboard:
    get:
      summary: Leaderboard (top users by rewards)
      responses:
        '200': { description: OK }

  /api/v1/admin/users/{id}/approve:
    patch:
      summary: Approve user
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/admin/users/{id}/suspend:
    patch:
      summary: Suspend user
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }

  /api/v1/admin/stats:
    get:
      summary: Admin stats
      security: [ { bearerAuth: [] } ]
      responses:
        '200': { description: OK }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        _id: { type: string }
        name: { type: string }
        email: { type: string }
        role: { type: string }
        avatar: { type: string }
        rewards: { type: number }
    Lesson:
      type: object
      properties:
        title: { type: string }
        content: { type: string }
        videoUrl: { type: string }
        duration: { type: number }
    Course:
      type: object
      properties:
        _id: { type: string }
        title: { type: string }
        description: { type: string }
        price: { type: number }
        instructor: { $ref: '#/components/schemas/User' }
        lessons:
          type: array
          items: { $ref: '#/components/schemas/Lesson' }
        published: { type: boolean }
    Event:
      type: object
      properties:
        _id: { type: string }
        title: { type: string }
        description: { type: string }
        date: { type: string, format: date-time }
        capacity: { type: number }
    Comment:
      type: object
      properties:
        user: { $ref: '#/components/schemas/User' }
        text: { type: string }
    Post:
      type: object
      properties:
        _id: { type: string }
        user: { $ref: '#/components/schemas/User' }
        content: { type: string }
        image: { type: string }
        likes:
          type: array
          items: { type: string }
        comments:
          type: array
          items: { $ref: '#/components/schemas/Comment' }